<html>
    <head>
        <title>Network Difficulty Hashrate Graphing Tool</title>

        <!-- load jquery in head -->
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

        <script src="js/Highcharts-3.0.9/js/highcharts.js"></script>

        <script type="text/javascript">
        var diffPlot;

        function loadGraphData(initailLoad) {
            $.get('ajax/getGraphData.php', function( data ) {
                var obj = $.parseJSON(data);
                initGraph(obj[0], obj[1], obj[2], obj[3], obj[4]);

                //setInterval(liveGraphData, 10000);
            });
        }

        function liveGraphData() {
            $.get('ajax/getLiveGraphData.php', function( data ) {
                var obj = $.parseJSON(data);
                console.debug(obj);
                addGraphPoints(obj[0], obj[1], obj[2], obj[3], obj[4]);
            });
        }

        function addGraphPoints(block, diff, net, time) {
            var chart = $('#diffPlot').highcharts();
            chart.series[0].addPoint(block.data[0]);
            chart.series[1].addPoint(diff.data[0]);
            chart.series[2].addPoint(net.data[0]);
        }

        function initGraph(blockheight, diff, hash, timestamps, blocktimes) {
            var a = new Date(timestamps.data[0] * 1000);
            var utc = Date.UTC(a.getFullYear(), a.getMonth(), a.getDate(), a.getHours(), a.getMinutes(), a.getSeconds());

            $('#diffPlot').highcharts({
                chart: {
                    type: 'spline'
                },
                xAxis: [{
                    type: 'datetime',
                    maxZoom: 10 * 1000
                },{
                    type: 'linear'
                }],
                yAxis: [{
                    title: {
                        text: 'Block Height',
                        style: {
                            color: '#333333'
                        }
                    },
                    opposite: true},
                    {
                    title: {
                        text: 'Diff',
                        style: {
                            color: '#ff0000'
                        }
                    }},
                    {
                    title: {
                        text: 'Hash',
                        style: {
                            color: '#0000ff'
                        }
                    },
                    opposite: true},
                    {
                    title: {
                        text: 'Block Time',
                        style: {
                            color: '#000066'
                        }
                    },
                    opposite: true}],
                series: [blockheight, diff, hash, blocktimes],
                tooltip: {
                    shared: true
                },
                plotOptions: {
                    spline: {
                        lineWidth: 4,
                        states: {
                            hover: {
                                lineWidth: 5
                            }
                        },
                        marker: {
                            enabled: false
                        },
                        pointInterval: 60*15*1000, // 15min
                        pointStart: utc
                    }
                }
            });
        }



        $(document).ready(function() {
            loadGraphData(true);
        });

        </script>
    </head>

    <body>
        <div id="diffPlot"></div>
    </body>
</html>